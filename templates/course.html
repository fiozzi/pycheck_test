{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} Course: {% endblock %}</h1>
    <div class='course'>
        ID: <b>{{ course['IDcourse'] }}</b><br />
        Course Code:<b>{{ course['Coursecode'] }}</b><br />
        Course Name:<b>{{course['Coursename'] }}</b><br />
        Department:<b>{{course['Department'] }}</b><br />
        Program:<b>{{course['Program'] }}</b><br />
        Manager:<b>{{course['Manager'] }}</b><br />
        course in charge:<b>{{course['firstname'] }} {{course['lastname'] }}</b><br />
    </div>
    <hr>
    <form name="edit_course_data" action="{{ url_for('edit_course', idcourse=course['IDcourse']) }}" method="GET">
        <input type="submit" value="Edit data above">
    </form>
    <br />
    <form name="delete_course" action="{{ url_for('delete_course', idcourse=course['IDcourse']) }}" method="POST">
        <input type="submit" value="Delete course above" onclick="return confirm('Are you sure you want to delete this course?')">
    </form>
    <br />

    <table style="border-spacing: 10px 0;">
        <tr>
            <th></th>
            <th style="text-align: left;">Hours</th>
            <th style="text-align: left;">Semester, Class</th>
            <th>Actions</th>
        </tr>
        <div class='hours'>
            {% for course_hour in course_hours %}
            <tr>
                <td>{{ course_hour['CourseCode'] }} {{ course_hour['CourseName'] }}</td>
                <td style="text-align: left;">
                    {{ course_hour['TotalTeachingHours'] }} ({{ course_hour['TeachingType']}}) - 
                    {% if course_hours_total[course_hour['IDcoursehours']]['TotalTeaching'] == course_hour['TotalTeachingHours'] %}
                    <span style="color: blue; font-weight: bold;">
                        {{ course_hours_total[course_hour['IDcoursehours']]['TotalTeaching'] }}
                    </span>
                    {% else %}
                    <span style="color: red; font-weight: bold;">
                        {{ course_hours_total[course_hour['IDcoursehours']]['TotalTeaching'] }}
                    </span>
                {% endif %}
                </td>
                <td style="text-align: left;">{{ course_hour['Semester'] }}, {{ course_hour['Class']}}</td>
                <td style="display: flex;">
                    <form name="edit_hours_{{ course_hour['IDcoursehours'] }}" 
                        action="{{ url_for('edit_course_hour', idcoursehours=course_hour['IDcoursehours']) }}" method="GET">
                    <input type="submit" value="Edit this">
                    </form>
                    <form name="remove_course_hours_{{ course_hour['IDcoursehours'] }}" 
                        action="{{ url_for('remove_course_hour', idcoursehours=course_hour['IDcoursehours']) }}" method="POST">
                    <input type="submit" value="Delete this" onclick="return confirm('Are you sure you want to delete this hours slot?')">
                    </form>
                </td>
            </tr>
                {% for t_slot in teachingslots[course_hour['IDcoursehours']] %}
                <tr>
                    <td>{{ t_slot['lastname'] }}</td>
                    <td style="text-align: left;">{{ t_slot['hours'] }}</td>
                    <td style="text-align: left;"></td>
                    <td style="display: flex;">
                        <form name="remove_teachers_hours_{{ t_slot['IDTeachershours'] }}" 
                            action="{{ url_for('remove_teachers_hour', idteachershours=t_slot['IDTeachershours']) }}" method="POST">
                            <input type="hidden" name="idcourse" value="{{ course['idcourse'] }}"></input>
                            <input type="submit" value="Delete this" onclick="return confirm('Are you sure you want to delete this hours slot?')">
                        </form>
                    </td>
                </tr>
                {% endfor %}
            <tr>
                <form name="add_teachers_hours_{{ course_hour['IDcoursehours'] }}" 
                    action="{{ url_for('add_teachers_hour', idcoursehours = course_hour['IDcoursehours']) }}" method="POST">
                    <td>
                        <select name="idteacher">
                            <option selected value="0"> -- select a teacher -- </option>
                            {% for teacher in teachers %}
                                <option value="{{ teacher['IDteacher'] }}">
                                    {{ teacher['Lastname'] }} {{ teacher['Firstname'] }}
                                </option>
                            {% endfor %}
                        </select>                
                    </td>
                    <td><input type="number" name="hours" value="{{ request.form['hours'] }}"></input></td>
                    <td><input type="hidden" name="idcourse" value="{{ course['idcourse'] }}"></input></td>
                    <td><input type="submit" value="Add this"></td>
                </form>
            </tr>
            <tr>
                <td style="padding: 10px;"></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            {% endfor %}
        </div>
    </table>
    <br />
    <br />
    <form name="add_course_hours_{{ course['IDCourse'] }}" action="{{ url_for('add_course_hour', idcourse=course['idcourse'] )}}" method="POST">
        <b>Add Course hours:</b><br />
        <label for="teachingtype">Teaching Type: </label>
        <select name="idteachingtype">
            {% for t_type in teachingtypes %}
                <option value="{{ t_type['idteachingtype'] }}">{{ t_type['teachingtype'] }}</option>
            {% endfor %}
        </select>
        <br>

        <label for="semester">Semester</label>
        <select name="idsemester">
            {% for semester in semesters %}
                <option value="{{ semester['idsemester'] }}">{{ semester['semester'] }}</option>
            {% endfor %}
        </select>
        <br>

        <label for="class">Class</label>
        <select name="idclass">
            {% for t_class in t_classes %}
                <option value="{{ t_class['IDClass'] }}">{{ t_class['class'] }} {{ t_class['program'] }}</option>
            {% endfor %}
        </select>
        <br>
        Hours: <input type="number" name="totalteachinghours" value="{{ request.form['totalteachinghours'] }}"></input><br />
        <input type="submit" value="Add this">
    </form>


{% endblock %}